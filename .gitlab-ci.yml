stages:
  - build_sbb_image

  
build_sbb_image:
  stage: build_sbb_image  
  before_script:
    - sudo git clean -ffdx
  script: 
    # cleaning up old working files built by root on previous ci runs
    - sudo rm -fR ./work/*
    # update apt repos
    - sudo apt-get update  
    # install dependencies
    - sudo apt-get -yy install git vim parted debootstrap zerofree zip dosfstools bsdtar libcap2-bin rsync grep udev xz-utils curl xxd file kmod quilt qemu-user-static
    # build sbb image using variables 
    - sudo ./build.sh -c smart_black_box.conf
    # copy image file to destination
    - sudo cp ./deploy/*.zip /mnt/software/IMG/faccos-sbb
  only: 
    - master